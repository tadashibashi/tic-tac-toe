/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t,e,r=function(t,e,r){if(r||2===arguments.length)for(var o,n=0,s=e.length;n<s;n++)!o&&n in e||(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))},o=function(){function t(){this.callbacks=[]}return t.prototype.addListener=function(t,e){void 0===e&&(e=null),this.callbacks.push({context:e,callback:t})},t.prototype.removeListener=function(t,e){void 0===e&&(e=null);for(var r=0;r<this.callbacks.length;++r)if(Object.is(this.callbacks[r].callback,t)&&(!e||Object.is(this.callbacks[r].context,e)))return this.callbacks.splice(r,1),!0;return!1},t.prototype.invoke=function(){for(var t,e,o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];for(var s=0;s<this.callbacks.length;++s)this.callbacks[s].context?(t=this.callbacks[s].callback).call.apply(t,r([this.callbacks[s].context],o,!1)):(e=this.callbacks[s]).callback.apply(e,o)},Object.defineProperty(t.prototype,"length",{get:function(){return this.callbacks.length},enumerable:!1,configurable:!0}),t.prototype.clear=function(){this.callbacks=[]},t}(),n=function(){function t(t,e){this.mState=t,this.mProps=e,this.statechange=new o,this.stateHistory=[]}return Object.defineProperty(t.prototype,"state",{get:function(){return this.mState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"props",{get:function(){return this.mProps},enumerable:!1,configurable:!0}),t.prototype.reducer=function(t,e,r){var o=this.reducerImpl(t,e,this.mState);if(!Object.is(this.mState,o)){var n={state:o,time:new Date};this.logState(n,this.stateHistory.length),this.stateHistory.push(n),this.mState=o,this.statechange.invoke(this,r)}},t.prototype.logStateHistory=function(t){void 0===t&&(t=0);for(var e=this.stateHistory.length,r=t<1?0:Math.max(e-t,0);r<e;++r)this.logState(this.stateHistory[r],r)},t.prototype.logState=function(t,e){console.log("State #".concat(e," | ").concat(t.time.toLocaleTimeString())),console.dir(t.state)},t}();!function(t){t[t.Null=0]="Null",t[t.X=1]="X",t[t.O=2]="O"}(t||(t={})),function(t){t[t.None=0]="None",t[t.X=1]="X",t[t.O=2]="O",t[t.Cats=3]="Cats"}(e||(e={}));var s,i,a,c=function(){function r(t){var e=this;t?(this.rows=[],t.forEach((function(t){return e.rows.push(function(t,e,r){if(r||2===arguments.length)for(var o,n=0,s=e.length;n<s;n++)!o&&n in e||(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}([],t,!0))}))):this.reset()}return r.prototype.copy=function(){return new r(this.rows)},r.prototype.reset=function(){this.rows=[[t.Null,t.Null,t.Null],[t.Null,t.Null,t.Null],[t.Null,t.Null,t.Null]]},r.prototype.forEachRow=function(t){this.rows.forEach(t)},r.prototype.spaceEmpty=function(e,r){return this.rows[e][r]===t.Null},r.prototype.set=function(t,e,r){this.rows[t][e]=r},r.prototype.get=function(t,e){return this.rows[t][e]},r.prototype.nextOptimalMove=function(t){for(var e=-1/0,r=[],o=this.rows.length,n=this.rows[0].length,s=0;s<o;++s)for(var i=0;i<n;++i){var a=this.rateCell(s,i,t);a>e?(e=a,r=[{row:s,col:i}]):a===e&&r.push({row:s,col:i})}var c=Math.floor(Math.random()*r.length);return{row:r[c].row,col:r[c].col,rating:e}},r.prototype.rateCell=function(t,e,r){if(0!==this.get(t,e))return 0;for(var o=this.rows[0].length,n=this.rows.length,s=0,i=0,a=0;a<o;++a)if((c=a===e?r:this.get(t,a))===r)i=(i+1)*o;else if(0!==c){i=0;break}for(s+=i,i=0,a=0;a<n;++a)if((c=a===t?r:this.get(a,e))===r)i=(i+1)*n;else if(0!==c){i=0;break}if(s+=i,n!=o)return s;if(t==e){for(i=0,a=0;a<n;++a)if((c=a===t?r:this.get(a,a))===r)i=(i+1)*n;else if(0!==c){i=0;break}s+=i}if(n-1-t===e){for(i=0,a=0;a<n;++a){var c,l=n-1-a;if((c=l===t&&a===e?r:this.get(l,a))===r)i=(i+1)*n;else if(0!==c){i=0;break}}s+=i}return s},r.prototype.checkWin=function(r){if(r)return(o=this.__checkWin(r)).didWin?{result:r===t.O?e.O:e.X,squares:o.squares}:this.__boardFull()?{result:e.Cats}:{result:e.None};var o=void 0;return(o=this.__checkWin(t.X))?{result:e.X,squares:o.squares}:(o=this.__checkWin(t.O))?{result:e.O,squares:o.squares}:this.__boardFull()?{result:e.Cats}:{result:e.None}},r.prototype.__checkWin=function(t){for(var e=[{row:-1,col:-1},{row:-1,col:-1},{row:-1,col:-1}],r=0;r<this.rows.length;++r){for(var o=!0,n=0;n<this.rows[0].length;++n){if(this.rows[r][n]!==t){o=!1;break}e[n]={row:r,col:n}}if(o)return{squares:e,didWin:o}}for(n=0;n<this.rows[0].length;++n){var s=!0;for(r=0;r<this.rows.length;++r){if(this.rows[r][n]!==t){s=!1;break}e[r]={row:r,col:n}}if(s)return{squares:e,didWin:s}}for(var i=!0,a=0;a<this.rows.length;++a){if(this.rows[a][a]!==t){i=!1;break}e[a]={row:a,col:a}}if(i)return{squares:e,didWin:i};for(i=!0,a=0;a<this.rows.length;++a){if(this.rows[this.rows.length-1-a][a]!==t){i=!1;break}e[a]={row:this.rows.length-1-a,col:a}}return{didWin:i,squares:e}},r.prototype.__boardFull=function(){for(var e=0;e<this.rows.length;++e)for(var r=0;r<this.rows[e].length;++r)if(this.rows[e][r]===t.Null)return!1;return!0},r}(),l=(s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},s(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});!function(t){t[t.Start=0]="Start",t[t.P1Turn=1]="P1Turn",t[t.P2Turn=2]="P2Turn",t[t.Result=3]="Result"}(i||(i={})),function(t){t[t.SetBoard=0]="SetBoard",t[t.SetMessage=1]="SetMessage",t[t.SetWinner=2]="SetWinner",t[t.Reset=3]="Reset"}(a||(a={}));var u=function(e){function r(){var t={boardEl:document.getElementById("board"),displayEl:document.getElementById("display"),resetBtnEl:document.getElementById("reset-btn"),compSliderEl:document.querySelector(".slider-box input"),computerP2:!1},r={board:new c,message:"Welcome",gameState:i.Start};return e.call(this,r,t)||this}return l(r,e),r.prototype.setSym=function(t,e,r){this.reducer(a.SetBoard,{row:t,col:e,sym:r},!0)},r.prototype.setMessage=function(t){this.reducer(a.SetMessage,t,!0)},r.prototype.setWinner=function(t){this.reducer(a.SetWinner,t,!0)},r.prototype.reset=function(){this.reducer(a.Reset,null,!0)},r.prototype.reducerImpl=function(e,r,o){var n=this;switch(e){case a.SetBoard:var s={board:o.board.copy(),message:o.message,gameState:o.gameState};return r.sym===t.O?(s.message="Player X's Turn",s.gameState=i.P2Turn):(s.message="Player O's Turn",s.gameState=i.P1Turn),s.board.set(r.row,r.col,r.sym),s;case a.SetMessage:return{board:o.board.copy(),message:r,gameState:o.gameState};case a.SetWinner:var l,u=void 0;switch(r.sym){case t.O:u="Player O Won!",l="green";break;case t.X:u="Player X Won!",l="red";break;case t.Null:u="Cats Game!",l="gray"}if(r.sym===t.Null)for(var p=0;p<9;++p)this.props.boardEl.children[p].style.background=l;else r.squares&&r.squares.forEach((function(t){n.props.boardEl.children[3*t.row+t.col].style.background=l}));return{board:o.board.copy(),message:u,gameState:i.Result};case a.Reset:for(p=0;p<9;++p)this.props.boardEl.children[p].style.background="white";return{board:new c,message:"Player O's Turn",gameState:i.P1Turn};default:return o}},r}(n),p=function(){function t(t){this.model=t,t.statechange.addListener(this.render,this),this.render(t,!0)}return t.prototype.render=function(t,e){e&&this.renderImpl(t)},t.prototype.close=function(){this.model.statechange.removeListener(this.render,this)},t}(),f=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),h=function(e){function r(t){return e.call(this,t)||this}return f(r,e),r.prototype.renderImpl=function(e){e.props.displayEl.innerText=e.state.message;var r=e.props.boardEl.children;e.state.board.forEachRow((function(e,o){for(var n=0;n<3;++n){var s=r[3*o+n];switch(e[n]){case t.O:s.innerText="O";break;case t.X:s.innerText="X";break;case t.Null:s.innerText=""}}}))},r}(p);function d(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)t[o]=r[o]}return t}var m=function t(e,r){function o(t,o,n){if("undefined"!=typeof document){"number"==typeof(n=d({},r,n)).expires&&(n.expires=new Date(Date.now()+864e5*n.expires)),n.expires&&(n.expires=n.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var i in n)n[i]&&(s+="; "+i,!0!==n[i]&&(s+="="+n[i].split(";")[0]));return document.cookie=t+"="+e.write(o,t)+s}}return Object.create({set:o,get:function(t){if("undefined"!=typeof document&&(!arguments.length||t)){for(var r=document.cookie?document.cookie.split("; "):[],o={},n=0;n<r.length;n++){var s=r[n].split("="),i=s.slice(1).join("=");try{var a=decodeURIComponent(s[0]);if(o[a]=e.read(i,a),t===a)break}catch(t){}}return t?o[t]:o}},remove:function(t,e){o(t,"",d({},e,{expires:-1}))},withAttributes:function(e){return t(this.converter,d({},this.attributes,e))},withConverter:function(e){return t(d({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(e)}})}({read:function(t){return'"'===t[0]&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),y=function(){function r(t){this.model=t,this.init(),this.computerTimeout=null}return r.prototype.detectCrossAttack=function(t){for(var e=0,r=this.model.state.board,o=0;o<3;++o)for(var n=0;n<3;++n)0!==r.get(o,n)&&++e;if(3!==e)return 0;for(var s=0,i=!0,a=0;a<3;++a)if(0===this.model.state.board.get(a,a)){i=!1;break}if(i)s=1;else{for(i=!0,a=0;a<3;++a)if(0===this.model.state.board.get(2-a,a)){i=!1;break}i&&(s=2)}if(1===s){if(0!==r.get(0,0)&&r.get(0,0)!==t&&r.get(1,1)===t&&0!==r.get(2,2)&&r.get(2,2)!==t)return 1}else if(2===s&&0!==r.get(2,0)&&r.get(2,0)!==t&&r.get(1,1)===t&&0!==r.get(0,2)&&r.get(0,2)!==t)return 1;return s?2:0},r.prototype.optimalCell=function(e){var r=this.model.state.board,o=r.nextOptimalMove(t.O),n=r.nextOptimalMove(t.X),s=this.detectCrossAttack(e);if(1===s){if(r.spaceEmpty(0,1))return{row:0,col:1};if(r.spaceEmpty(1,0))return{row:1,col:0};if(r.spaceEmpty(2,1))return{row:2,col:1};if(r.spaceEmpty(1,2))return{row:1,col:2}}else if(2===s){if(console.log("cross attack v2!"),r.spaceEmpty(0,0))return{row:0,col:0};if(r.spaceEmpty(2,0))return{row:2,col:0};if(r.spaceEmpty(2,2))return{row:2,col:2};if(r.spaceEmpty(0,2))return{row:0,col:2}}if(e===t.O)return o.rating>=n.rating?{row:o.row,col:o.col}:{row:n.row,col:n.row};if(e===t.X)return n.rating>=o.rating?{row:n.row,col:n.col}:{row:o.row,col:o.col};throw new Error("[GameController.optimalCell]: Sym is an invalid value!")},r.prototype.init=function(){var e=this,r=this.model.props.boardEl,o=this.model.props.resetBtnEl,n=this.model.props.compSliderEl;r.addEventListener("click",(function(n){var s,a,c=n.target;if(c!==r){var l=(s=c.getAttribute("id"),(a={}).row=Number(s[1]),a.col=Number(s[3]),a),u=e.model.state.gameState;switch(u){case i.Start:e.model.reset(),o.innerText="Reset Game";break;case i.P1Turn:case i.P2Turn:u===i.P2Turn&&e.model.props.computerP2||(c.classList.add("pop-in"),e.statePlayerTurn(l.row,l.col,u===i.P1Turn?t.O:t.X))}}})),r.addEventListener("animationend",(function(t){var e=t.target;e!==r&&"pop-in"===t.animationName&&e.classList.remove("pop-in")})),o.addEventListener("click",(function(t){e.model.reset(),o.innerText="Reset"})),n.addEventListener("input",(function(t){e.model.props.computerP2=n.checked,m.set("computer-p2",n.checked?"true":"false",{expires:365}),n.checked&&e.model.state.gameState===i.P2Turn&&e.computerTurn()})),"true"===m.get("computer-p2")&&(n.checked=!0,this.model.props.computerP2=!0),setTimeout((function(){e.model.state.gameState!==i.P1Turn&&(e.model.reset(),o.innerText="Reset")}),1e3)},r.prototype.statePlayerTurn=function(r,o,n){if(this.model.state.board.spaceEmpty(r,o)){this.model.setSym(r,o,n);var s=this.model.state.board.checkWin(n);s.result===e.X||s.result===e.O?this.model.setWinner({sym:n,squares:s.squares}):s.result===e.Cats&&this.model.setWinner({sym:t.Null}),this.model.state.gameState===i.P2Turn&&this.model.props.computerP2&&n===t.O&&this.computerTurn()}},r.prototype.computerTurn=function(){var e=this;null!==this.computerTimeout&&clearTimeout(this.computerTimeout),this.computerTimeout=setTimeout((function(){var r=e.optimalCell(t.X);e.statePlayerTurn(r.row,r.col,t.X),document.getElementById("r"+r.row+"c"+r.col).click(),e.computerTimeout=null}),1e3)},r}(),g=function(){this.model=new u,this.view=new h(this.model),this.controller=new y(this.model)};window.onload=function(){new g}})();
//# sourceMappingURL=main.js.map